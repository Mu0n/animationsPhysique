<div id="imageContainer" class="aspectRation2-1"><div id="resistanceEcoulement"></div></div>

<div class="controls">
	<div class="details open">
		<h2 class="detailsAlwaysVisible" onclick="redraw('intro');">Introduction</h2>
		<p class="detailsToHide">On appelle un orifice un élément dont la longueur est plus petite que le diamètre de l'ouverture par opposition à un tube qui sera plus long que le diamètre de son ouverture.</p>
		<p class="detailsToHide">Pour un tube, l'écoulement dépend de la viscosité du fluide alors que pour un orifice c'est la densité du fluide qui est importante.</p>
		<p class="detailsToHide">Dans l'équation du débit d'un fluide par un orifice, le carré du débit ($Q$) est proportionnel au carré de l'aire de l'orifice ($A$), proportionnel à la différence de pression ($ΔP$) et inversement proportionnel à la densité ($ρ$). L'équation comporte aussi un facteur de proportionnalité ($k$). $$Q^2 = {{k A^2 \Delta P} \over \rho}$$</p>
		<label for="ouvertureDiameter">Diamètre de l'ouverture:&nbsp;<input type="range" id="ouvertureDiameter" name="ouvertureDiameter" value="30" max="50" min="15" step="0.1" oninput="redraw()" onchange="redraw()"></label>
		<label for="deltaPression">Variation de la pression:&nbsp;<input type="range" id="deltaPression" name="deltaPression" value="10" max="20" min="5" step="0.1" oninput="redraw()" onchange="redraw()"></label>
		<label for="densite">Densité du gaz:&nbsp;<input type="range" id="densite" name="densite" value="1" max="2" min="0.5" step="0.05" oninput="redraw()" onchange="redraw()"></label>

		<h2 class="detailsAlwaysVisible" onclick="redraw('debit');">Influence du débit</h2>
		<p class="detailsToHide">On appelle un orifice un élément dont la longueur est plus petite que le diamètre de l'ouverture par opposition à un tube qui sera plus long que le diamètre de son ouverture.</p>
		<p class="detailsToHide">Pour un tube, l'écoulement dépend de la viscosité du fluide alors que pour un orifice c'est la densité du fluide qui est importante.</p>
		<p class="detailsToHide">Dans l'équation du débit d'un fluide par un orifice, le carré du débit ($Q$) est proportionnel au carré de l'aire de l'orifice ($A$), proportionnel à la différence de pression ($ΔP$) et inversement proportionnel à la densité ($ρ$). L'équation comporte aussi un facteur de proportionnalité ($k$). $$Q^2 = {{k A^2 \Delta P} \over \rho}$$</p>

	</div>





</div>

<script src='utils/includes/pipes.js?v=<?php echo mt_rand(); ?>'></script>
<script src='utils/includes/vector.js?v=<?php echo mt_rand(); ?>'></script>
<script>
  //Création de l'élément svg (l'image).
  var draw = SVG('resistanceEcoulement').viewbox({ x: 0, y: 0, width: 1000, height: 500 });

	//Définition des paramètres par défaut du système.
	var diameter = 30; //Diamètre de l'ouvertude
	var dP = 10; //Variation de pression
	var densite = 1; //Densité du gaz

	//Chargement des gradients
	draw.svg(vPipe);
	draw.svg(hPipe);
	draw.svg(hPipeInt);

	/////////////////////////////////////////////////////////////////////
 	// Création des différents éléments de l'image pour l'introduction //
	/////////////////////////////////////////////////////////////////////
	var intro = draw.group();

	//Dessin du tube
 	intro.path('M 100 50 a 20 50 0 0 0 0 100 h 500 a 20 50 0 0 1 0 -100 z').attr({ fill: "url(#hPipe)"});
  intro.path('M 600 50 a 20 50 0 0 0 0 100 a 20 50 0 0 0 0 -100 z').attr({ fill: darkestCopper});
	intro.path('M 600 60 a 16 40 0 0 0 0 80 a 16 40 0 0 0 0 -80 z').attr({ fill: "url(#hPipeInt)"});

	//Texte expliquant le tube
	intro.text('Tube: ').font({size: '40'}).move(700,80).build(true).tspan('L').font({style: 'italic'}).tspan(' > ').font({style: 'normal'}).tspan('D').font({style: 'italic'})

	//Longueur du tube
	intro.text('L').font({size: '40', style: 'italic'}).move(320,170)
	intro.line(100, 190, 300, 190).stroke({ width: 2, color: 'black' }).marker('start', 10, 10, function(add) {
  	add.line(0,0,0,10).cx(5).stroke({ width: 1, color: 'black' })
	})
	intro.line(360, 190, 600, 190).stroke({ width: 2, color: 'black' }).marker('end', 10, 10, function(add) {
  	add.line(0,0,0,10).cx(5).stroke({ width: 1, color: 'black' })
	})

	//Diamètre du tube
	intro.text('D').font({size: '40', style: 'italic'}).move(33,75)
	intro.line(50, 50, 50, 70).stroke({ width: 2, color: 'black' }).marker('start', 10, 10, function(add) {
  	add.line(0,0,0,10).cx(5).stroke({ width: 1, color: 'black' })
	})
	intro.line(50, 125, 50, 150).stroke({ width: 2, color: 'black' }).marker('end', 10, 10, function(add) {
  	add.line(0,0,0,10).cx(5).stroke({ width: 1, color: 'black' })
	})

	//Dessin du tube et un orifice
	var tubeO = draw.group();
	tubeO.path('M 100 300 v 10 h 500 v -10 z').attr({ fill: darkCopper});
	tubeO.path('M 100 390 v 10 h 500 v -10 z').attr({ fill: darkCopper});
	tubeO.path('M 600 300 v 10 a 16 40 0 0 1 0 80 v 10 a 20 50 0 0 0 0 -100 z').attr({ fill: darkestCopper});
	tubeO.path('M 100 310 a 16 40 0 0 1 0 80 h 500 a 16 40 0 0 0 0 -80 z').attr({ fill: "url(#hPipeInt)"});
	//Orifice
	var ouvertureRight = tubeO.path('M 355 310 v '+(40-diameter/2)+' a '+(diameter/5)+' '+(diameter/2)+' 0 0 1 0 '+(diameter)+' v'+(40-diameter/2)+' a 16 40 0 0 0 0 -80 z').attr({ fill: darkestCopper});
	var ouvertureTop = tubeO.path('M 355 310 h-10 v '+(40-diameter/2)+' h10 z').attr({ fill: darkCopper});
	var ouvertureBottom = tubeO.path('M 355 390 h-10 v '+(-40+diameter/2)+' h10 z').attr({ fill: darkCopper});
	var ouvertureBack = tubeO.path('M 345 '+(350-diameter/2)+' a '+(diameter/5)+' '+(diameter/2)+' 0 0 1 0 '+(diameter)+' h10 a '+(diameter/5)+' '+(diameter/2)+' 0 0 0 0 -'+(diameter)+' z').attr({ fill: darkerCopper});

	//Texte expliquant l'orifice
	intro.text('Orifice: ').font({size: '40'}).move(700,320).build(true).tspan('L').font({style: 'italic'}).tspan(' < ').font({style: 'normal'}).tspan('D').font({style: 'italic'})

	//Longueur de l'orifice
	intro.text('L').font({size: '40', style: 'italic'}).move(340,430)
	intro.line(300,420, 342, 420).stroke({ width: 2, color: 'black' }).vector({size:1.5,position:'end',style:'mesure'})
	intro.line(400,420, 358, 420).stroke({ width: 2, color: 'black' }).vector({size:1.5,position:'end',style:'mesure'})

	//Diamètre de l'orifice
	intro.text('D').font({size: '40', style: 'italic'}).move(20,330)
	var quoteLine1 = intro.line(70,305, 70, 350-diameter/2).stroke({ width: 2, color: 'black' }).vector({size:1.5,position:'end',style:'mesure'})
	var quoteLine2 = intro.line(70,395, 70, 350+diameter/2).stroke({ width: 2, color: 'black' }).vector({size:1.5,position:'end',style:'mesure'})

	var path1 = tubeO.path('M 80 -30 c 120 0 240 0 260 '+(8*(80-diameter)/25)+' s 120 -'+((80-diameter)/10)+' 160 -'+((80-diameter)/5)+' s 90 -'+(3*(80-diameter)/25)+' 120 -'+(3*(80-diameter)/25)+' h 100').stroke('none').fill('none');
	var matrix = path1.matrixify();
	var path2 = tubeO.path('M 80 380 c 120 0 240 0 260 -'+(8*(80-diameter)/25)+' s 120 '+((80-diameter)/10)+' 160 '+((80-diameter)/5)+' s 90 '+(3*(80-diameter)/25)+' 120 '+(3*(80-diameter)/25)).stroke('none').fill('none');
	var matrix2 = path2.matrixify();

	var length = path1.length();

	var tubeMask = draw.mask().add(draw.path('M 80 310 a 16 40 0 0 1 0 80 h 530 a 16 40 0 0 0 0 -80 z').fill({ color: '#fff' }))

/*	SVG.easing['flow'] = function(t){
		var A = diameter*diameter/2500; //Aire entre 0.09 et 1
		var P = dP/20; //Pression entre 0.25 et 1
		var D = densite*2; //Densité entre 1 et 4

		var baseSpeed = A*Math.sqrt(P/D); //entre 0.0225 et 1
		var slowestSpeed = baseSpeed*Math.sqrt(diameter/50);

		var pos = [0, 0.2, 0.3, 0.4, 0.49-0.01*baseSpeed, 0.52+0.03*baseSpeed, 0.62+0.1*baseSpeed,1];
		var speeds = [baseSpeed, 0.7*baseSpeed+0.3*slowestSpeed, 0.35*baseSpeed+0.65*slowestSpeed, slowestSpeed ]
		var times = [0];
		for(var i=0; i<speeds.length; i++) { times[i+1]=times[i]+(pos[i+1]-pos[i])/speeds[i]; }
		var fastSpeed =


		//var d = (80 - diameter)/70;
		//var pos   = [0, 0.3, 0.42, 0.48, 0.52, 0.62, 1];
		//var times = [0, pos[1]+d*0.1, pos[2]+d*0.18, pos[3]+d*0.27, pos[4]+d*0.26, pos[5]+d*0.2, 1];

		for(var i=1; i<pos.length; i++) {
			if(t<times[i]) {
				return ( (t-times[i-1]) * (pos[i]-pos[i-1]) / (times[i]-times[i-1]) + pos[i-1]);
			}
		}
		return 1;

	}*/

	function getX(t) {
		return 1000*t;
	}

	var particles=[], duree = 5000;
	var particlesPosition=[[8.02488, 0.91014], [9.56289, -0.68856], [5.35859, -0.32184], [6.12694, 0.80332], [6.05957, 0.9559], [5.17153, 0.08474], [7.59439, 0.01295], [6.87878, 0.02315], [7.7096, 0.11434], [5.89492, -0.51591], [6.37804, 0.15968], [9.85386, -0.80803], [6.49571, -0.02048], [8.49142, 0.23581], [9.53026, 0.85143], [2.42387, -0.70952], [9.45038, -0.48753], [4.47958, 0.15657], [3.03985, -0.63149], [6.3514, 0.50252], [7.2474, 0.71163], [2.10448, -0.09274], [1.77968, -0.90389], [8.44448, -0.18608], [8.62302, 0.29559], [2.83872, -0.26441], [2.39967, 0.2919], [1.74363, 0.68384], [2.95151, 0.65068], [4.62703, 0.66721], [2.69156, -0.47653], [1.02975, 0.51147], [9.08597, -0.34018], [1.81276, 0.2975], [6.09529, -0.91335], [8.1156, 0.12508], [4.96388, 0.73163], [8.91905, -0.89606], [9.53566, -0.93109], [2.54571, -0.77549], [0.86164, -0.84484], [0.65933, -0.93502], [3.42605, -0.9682], [5.53343, 0.38827], [6.00122, -0.6009], [1.94871, 0.99426], [8.20857, 0.29637], [8.97855, 0.70506], [7.72594, 0.68747], [3.45583, 0.68686], [9.82222, -0.55575], [3.69479, 0.60581], [1.65468, 0.79382], [3.33469, -0.59687], [2.00281, -0.62187], [9.02337, 0.91105], [6.29829, -0.88419], [4.66822, -0.12682], [5.63362, 0.26581], [6.97773, -0.33262], [0.9745, 0.10609], [7.15207, -0.54876], [4.84943, -0.99052], [9.61882, 0.58554], [6.75882, -0.91748], [6.40994, 0.86679], [5.35676, -0.77699], [3.72315, 0.83185], [7.66266, -0.94872], [6.77297, 0.6478], [7.46561, -0.98989], [9.95142, 0.23575], [5.4234, -0.99441], [6.01937, 0.36452], [8.69602, -0.1102], [5.2485, 0.79973], [5.82463, -0.959], [4.02406, 0.86154], [3.56722, -0.44591], [7.58485, -0.40664], [5.30498, 0.60007], [0.2191, 0.34478], [2.85873, -0.63159], [3.14434, 0.62638], [0.72084, -0.55377], [9.26486, -0.6254], [1.39832, -0.27308], [8.80824, -0.93837], [1.40147, 0.3882], [4.92317, 0.94654], [1.85054, -0.44735], [0.40999, 0.4868], [5.19804, -0.20263], [6.20834, -0.21705], [2.37497, 0.00537], [5.2757, -0.98252], [4.40565, -0.37157], [3.00778, 0.85012], [3.78013, -0.42298], [5.42083, 0.87076], [6.44455, -0.26854], [7.75539, -0.52659], [3.53815, -0.64877], [5.33759, -0.15601], [5.02735, 0.50097], [7.85651, -0.24591], [2.31749, 0.93232], [7.99454, -0.39964], [4.60145, -0.52087], [5.14656, 0.70242], [1.34834, 0.90358], [0.18241, -0.30542], [5.73612, 0.0119], [6.67978, 0.92722], [9.62176, -0.36861], [2.08419, 0.30835], [6.36596, -0.58092], [9.73197, -0.4037], [7.84406, -0.94305], [0.28376, 0.58394], [0.65478, -0.11351], [9.67764, -0.71399], [0.9578, -0.23274], [0.04252, 0.83708], [0.67596, 0.38288], [7.07382, 0.93051], [8.62583, 0.51293], [9.59346, -0.2312], [0.81315, 0.22534], [0.16546, -0.73712], [9.08103, -0.57565], [6.57417, 0.16061], [1.04408, 0.00479], [6.53431, 0.55592], [8.03267, -0.1268], [8.99045, -0.48182], [8.91399, 0.95373], [1.09661, 0.19419], [9.77116, 0.16079], [1.49589, -0.60215], [3.41505, -0.25557], [8.21625, 0.63539], [3.84198, -0.27788], [3.10952, -0.16413], [5.35003, -0.6328], [1.82947, 0.06395], [8.79876, 0.36182], [8.38003, -0.77665], [1.62214, -0.55732], [4.60806, 0.19494], [3.11501, 0.05], [1.68287, -0.39983], [8.32498, -0.61179], [0.88995, 0.34492], [4.4609, -0.57958], [2.60615, 0.33872], [2.29765, -0.9327], [8.96559, 0.3011], [9.32964, -0.31086], [3.72854, -0.72517], [6.99416, -0.97668], [4.13307, -0.01556], [7.47093, -0.61994], [9.35556, -0.04646], [4.2461, -0.61469], [7.57634, 0.2867], [7.35287, -0.33509], [6.85025, -0.24392], [0.45773, 0.32109], [5.36203, 0.08122], [7.28649, -0.05653], [5.20881, 0.24448], [9.75374, 0.53353], [0.75558, 0.51184], [7.92777, 0.08492], [0.03656, 0.66301], [3.19892, 0.90091], [8.00535, 0.25602], [2.91308, 0.17885], [0.2825, 0.70675], [8.70965, -0.64995], [3.11135, 0.47647], [0.81902, -0.02369], [4.79704, 0.77032], [7.86695, 0.42875], [9.65741, 0.40943], [6.09968, -0.3618], [4.97048, -0.09894], [7.56019, 0.42347], [8.08706, 0.60009], [7.42107, 0.57539], [7.64126, 0.54807], [8.29194, 0.87226], [7.10663, 0.56714], [8.1934, -0.59041], [0.1622, -0.55555], [0.34942, -0.94062], [1.53818, -0.19852], [2.05013, -0.29134], [1.00177, -0.88296], [2.9827, 0.33127], [0.40322, 0.87789], [7.92794, 0.74992], [6.99283, 0.65799], [5.51735, -0.21616], [6.98255, 0.21055], [7.03314, 0.04883], [8.62937, 0.88642], [1.03605, 0.31258], [5.59855, -0.53067], [9.80577, 0.77114], [4.02347, -0.67164], [5.19595, -0.59548], [3.78964, 0.21569], [3.99356, 0.64123], [1.10556, -0.78913], [0.90696, -0.54387], [0.68898, 0.70571], [8.16797, -0.8802], [0.02526, 0.2959], [2.7817, 0.18666], [6.10469, -0.08593], [5.56833, -0.85867], [3.83729, 0.74987], [8.28982, 0.03478], [8.12875, 0.39721], [0.2078, 0.12569], [8.3963, -0.5131], [6.7492, 0.24495], [3.68984, 0.34961], [1.50189, 0.17726], [3.50124, -0.78523], [0.10047, 0.06427], [2.7211, -0.12681], [1.86076, 0.44688], [0.04854, -0.26546], [4.23066, 0.5576], [4.41087, -0.24601], [3.00567, -0.84298], [7.81893, -0.66208], [4.0936, -0.35292], [3.57434, 0.50708], [1.79467, -0.61217], [0.76478, -0.27486], [8.68839, 0.17568], [4.87103, -0.42801], [1.36201, 0.70891], [2.7008, 0.55594], [5.94944, -0.32759], [9.23228, 0.20258], [9.17652, -0.42918], [5.07237, -0.5281], [0.84488, 0.65623], [6.58815, -0.68591], [4.90272, 0.38923], [0.72524, 0.07467], [2.25898, 0.12619], [5.73231, 0.72884], [9.48586, 0.3793], [6.10295, -0.48997], [4.78461, 0.65565], [5.07561, 0.26738], [0.21531, 0.83252], [6.00796, -0.83308], [9.7034, 0.00443], [2.20592, -0.39391], [6.70382, -0.2277], [4.58147, 0.3191], [0.96314, 0.65486], [5.4966, -0.42681], [5.17642, 0.48359], [0.48603, 0.79449], [7.99545, -0.61249], [8.85892, -0.49784], [2.89948, 0.42346], [5.73386, -0.28506], [2.8031, -0.37851], [7.24935, 0.85776], [4.33352, 0.3286], [4.52998, -0.33056], [1.12148, -0.54137], [8.51416, 0.84236], [1.70778, 0.06841], [1.35307, 0.5125], [6.94793, -0.77242], [9.43158, -0.84524], [8.47194, 0.54715], [2.22951, -0.11207], [0.92071, -0.38923], [3.17808, -0.97464], [3.24138, 0.04378], [1.10328, 0.65171], [4.58424, -0.9618], [5.86279, 0.39498], [4.51197, -0.03071], [2.61433, 0.70709], [0.9184, 0.77439], [1.26122, -0.59769], [6.2781, -0.71913], [4.14358, 0.9403], [4.50041, -0.74728], [4.29018, -0.36158], [3.87221, -0.09003], [4.64459, -0.70494], [4.69099, -0.90971], [2.03565, 0.72603], [6.86413, -0.52717], [4.19067, -0.91917], [2.79943, 0.81668], [3.7767, 0.96876], [2.93719, 0.97383], [1.55582, 0.50602], [7.61255, -0.55983], [1.31104, 0.08061], [2.55574, -0.20399], [3.07823, 0.74425], [4.38284, -0.08505], [6.22747, 0.06673], [9.27267, -0.97239], [5.36041, 0.28252], [1.42706, -0.74657], [6.17065, 0.44053], [7.11758, -0.42244], [2.23109, -0.6885], [0.61181, 0.80635], [3.60152, -0.20492], [5.71638, 0.48915], [9.40242, -0.97696], [0.12957, 0.58146], [1.90113, 0.79612], [6.2041, 0.6934], [1.19213, -0.91815], [1.49586, 0.78315], [2.1093, -0.94351], [7.07963, -0.87259], [7.91141, -0.04675], [4.4559, 0.43969], [5.84521, 0.23367], [9.27211, 0.08666], [3.74571, -0.99878], [5.67078, 0.96404], [5.04146, 0.99092], [6.95292, 0.45271], [7.20092, -0.23144], [7.47507, -0.0559], [9.80038, 0.34623], [9.22937, 0.35602], [0.60692, 0.48264], [8.13273, -0.28409], [8.70497, -0.31415], [3.56646, 0.84611], [6.72223, -0.49166], [0.25506, -0.03083], [4.94738, -0.32871], [4.90927, 0.16593], [5.92401, -0.73674], [0.03344, -0.93527], [0.58749, 0.22526], [3.30058, 0.32254], [3.92174, -0.58317], [0.66842, -0.41797], [9.99555, -0.6621], [1.00488, -0.61768], [6.26244, 0.94122], [6.49227, -0.89297], [9.19071, 0.9611], [9.87141, 0.96944], [8.62811, -0.42121], [9.60792, -0.50373], [5.13521, 0.83642], [1.60707, 0.68815], [3.18554, -0.39944], [0.52151, -0.38225], [9.79819, -0.11977], [5.72177, -0.12414], [4.8201, 0.01805], [8.5628, -0.25352], [9.66171, 0.75981], [4.34883, 0.52464], [1.88366, 0.66977], [8.97541, -0.07449], [9.41615, 0.71768], [1.38053, -0.40788], [7.64165, 0.97621], [3.39668, 0.2041], [8.18524, 0.51112], [8.94175, -0.31079], [5.35584, 0.99652], [3.32942, 0.68476], [5.51392, 0.70534], [7.2427, 0.30663], [6.94213, 0.76711], [3.29496, -0.44896], [2.63079, -0.93035], [3.65127, 0.18838], [0.18465, -0.17894], [3.53805, 0.95906], [8.55994, -0.5355], [7.50038, -0.29897], [6.72987, 0.12396], [5.52792, 0.97381], [9.33815, 0.29195], [3.67557, -0.51508], [5.07845, -0.6555], [5.95329, -0.17083], [4.64654, 0.8938], [9.99409, 0.98498], [3.91123, -0.99811], [8.55907, 0.12813], [9.03321, -0.80172], [1.58719, 0.93497], [2.44357, 0.5881], [2.20109, 0.64464], [4.97513, -0.97181], [7.19779, 0.47208], [2.805, 0.99392], [3.11859, 0.21277], [3.42059, 0.49733], [0.60046, -0.74313], [1.14073, -0.41447], [7.27611, -0.4796], [3.66563, -0.30971], [2.02266, 0.44595], [1.36498, -0.10286], [8.25807, -0.16763], [8.70852, -0.82375], [6.84187, 0.89837], [2.00114, 0.16072], [4.76003, -0.31959], [3.38081, 0.78662], [2.8088, 0.04377], [7.16936, -0.68675], [2.97243, 0.07039], [4.84559, -0.68339], [0.87345, -0.96764], [8.44952, -0.0361], [0.87861, 0.49113], [2.89215, -0.86722], [6.206, 0.20439], [3.86281, 0.61626], [8.32163, 0.32151], [8.63931, 0.66908], [2.14692, 0.82315], [3.24429, -0.81733], [3.29758, -0.21219], [9.46415, 0.9645], [2.15208, -0.82488], [6.41892, -0.42563], [4.22786, 0.38155], [4.13478, 0.14307], [9.38953, -0.59468], [4.51276, 0.79104], [2.65649, 0.22087], [9.96901, -0.81443], [2.02797, -0.48458], [9.20954, 0.63429], [1.34869, -0.5222], [8.76979, 0.71316], [3.9058, 0.24131], [6.68356, 0.41512], [2.90022, -0.48556], [3.72769, 0.08469], [4.70381, 0.45412], [5.59152, -0.71626], [9.96667, -0.37481], [1.98927, -0.97136], [4.30749, -0.73946], [0.39782, -0.22964], [1.10257, 0.81391], [3.1385, -0.74858], [7.40973, -0.51488], [4.01686, -0.15483], [9.49318, 0.53529], [3.87055, 0.09397], [8.2073, -0.0493], [5.06882, -2e-05], [4.70342, 0.30411], [8.28308, 0.18253], [8.86925, 0.48878], [9.26412, 0.86256], [4.86494, -0.56148], [2.62048, 0.90175], [5.22495, -0.32104], [2.51001, -0.03038], [8.58869, 0.00144], [4.11129, 0.72987], [5.06077, -0.26325], [4.51603, 0.9451], [0.37456, -0.79205], [7.40345, 0.97595], [4.77015, 0.91508], [4.98776, 0.61504], [8.78808, -0.02276], [2.65904, 0.03464], [1.54266, -0.08426], [4.30191, -0.97101], [1.94114, -0.84916], [8.85757, -0.72781], [8.17776, 0.80129], [6.65648, -0.00595], [3.01543, -0.42943], [7.81095, 0.30818], [3.66501, -0.02971], [3.99833, -0.01832], [2.54858, 0.44223], [9.61734, 0.94632], [7.46036, -0.84785], [7.23324, -0.92594], [1.89448, -0.68221], [7.53508, 0.75922], [7.4333, 0.28505], [0.30142, -0.66924], [7.40316, 0.8326], [3.04659, -0.06588], [6.2039, -0.95854], [9.57102, 0.01242], [0.55828, -0.19462], [9.92661, -0.21801], [5.23444, -0.06797], [2.30387, 0.53155], [9.08009, 0.43894], [4.1569, -0.19078], [8.88689, 0.79956], [2.15487, 0.48186], [0.29645, -0.32446], [1.23018, 0.795], [9.85148, -0.33034], [2.08852, 0.04459], [7.40938, -0.22246], [8.47985, -0.34195], [2.75412, -0.8357], [7.0864, 0.79516], [7.24738, 0.99067], [9.15373, 0.83019], [0.00082, -0.58565], [8.88961, 0.11287], [0.46438, 0.08594], [5.69201, -0.84029], [3.43494, -0.0904], [2.87122, -0.13159], [0.19581, -0.92839], [7.01115, -0.14863], [2.4327, -0.16886], [8.37368, 0.63765], [9.75505, -0.94288], [5.407, 0.39604], [8.29542, -0.9145], [5.9128, 0.06621], [7.97491, -0.98017], [0.3973, -0.08225], [9.39862, 0.06007], [0.82236, 0.86042], [9.29051, -0.46867], [0.06182, -0.09137], [2.02969, 0.59909], [4.70495, -0.46973], [1.21532, 0.5953], [6.58781, -0.16535], [1.17245, -0.22965], [7.24779, -0.80904], [1.25833, 0.9899], [6.87227, -0.95767], [7.90278, 0.5987], [3.34392, 0.91762], [1.23158, 0.27659], [0.10177, 0.45766], [4.28918, 0.7505], [5.58407, -0.98195], [6.64797, 0.53102], [4.18968, -0.78193], [8.75715, 0.8619], [6.52547, -0.49099], [3.54644, 0.08707], [3.8585, -0.82856], [8.55139, -0.13193], [9.37583, 0.51303], [7.80586, 0.53399], [6.50514, 0.76786], [6.26096, -0.36705], [1.40858, 0.27107], [1.49455, -0.97021], [0.46606, -0.65328], [4.28791, 0.19773], [3.69832, 0.48427], [5.93072, 0.54816], [0.29232, -0.50958], [8.51773, -0.69657], [4.06973, -0.85213], [1.18348, 0.08146], [1.65547, 0.22555], [0.79305, -0.73895], [9.47303, 0.26301], [7.78077, -0.82436], [7.99547, -0.26055], [4.37034, 0.63829], [2.01785, 0.89508], [1.37303, -0.90137], [8.04984, -0.84389], [2.97889, -0.26702], [8.10438, -0.46483], [7.72184, 0.42421], [3.2161, 0.72132], [1.07654, 0.95733], [9.49314, -0.31717], [7.23656, 0.18305], [0.45565, 0.64446], [9.22954, -0.18682], [0.54087, 0.0008], [2.74061, -0.68031], [8.47902, 0.36104], [8.03566, 0.48318], [7.61458, -0.25787], [1.62769, -0.67411], [2.46831, 0.78905], [3.56822, 0.64023], [4.97722, -0.74462], [7.82412, 0.16489], [7.85351, 0.9548], [2.35171, 0.79318], [1.73423, -0.05139], [1.47346, 0.5979], [2.80479, 0.33373], [2.27631, -0.24049], [9.09885, 0.05415], [5.81092, -0.19579], [6.41476, 0.98395], [5.75588, -0.41146], [4.03939, -0.46888], [3.89865, 0.35844], [8.21161, 0.98213], [9.19175, 0.489], [2.41373, 0.42704], [4.26493, 0.87635], [4.39959, 0.82816], [0.03644, -0.40889], [1.14711, -0.10851], [5.46591, 0.50058], [6.73186, -0.10088], [8.18267, -0.72887], [7.77966, -0.08899], [3.6304, -0.99732], [0.83141, -0.17036], [1.10029, 0.41767], [4.26149, -0.48341], [3.22936, 0.50392], [5.60998, 0.80158], [1.79017, 0.96249], [3.75954, -0.61266], [6.3277, -0.03446], [4.01901, 0.3834], [6.05293, 0.10219], [3.38733, 0.03867], [6.86812, 0.28839], [2.6901, -0.30231], [2.54274, -0.59092], [5.99588, -0.43229], [4.26461, -0.12611], [2.69237, 0.41358], [9.97637, -0.01927], [7.45157, 0.10197], [6.83219, -0.37507], [2.16947, 0.9546], [6.18584, -0.59357], [5.23624, 0.95405], [5.50115, 0.20066], [4.84725, 0.54087], [0.48778, 0.98872], [5.42336, -0.05857], [2.34211, -0.46769], [1.76339, -0.7657], [0.39855, -0.4211], [1.45259, 0.06987], [4.11625, -0.57131], [3.44413, -0.45778], [5.54472, 0.08651], [9.6314, -0.85954], [3.18321, -0.07589], [6.0665, 0.24027], [3.55215, 0.25338], [4.7577, -0.80681], [9.91106, 0.40261], [5.51373, -0.62579], [4.48462, -0.8833], [6.62197, 0.67178], [2.11983, -0.5531], [5.82925, 0.82178], [5.31963, -0.46756], [8.41478, 0.93855], [1.66814, -0.83737], [6.32458, -0.15748], [1.71185, 0.50562], [1.65277, -0.15488], [1.24318, -0.35954], [0.29372, 0.22989], [2.50268, -0.39522], [8.31436, -0.31679], [9.02288, -0.67425], [3.68698, -0.86825], [5.98244, -0.99969], [9.91646, -0.48562], [2.51461, 0.11923], [6.59264, -0.34849], [8.74402, -0.4969], [3.71348, -0.15532], [0.16103, 0.95633], [7.39724, 0.42209], [9.2621, -0.80997], [9.54959, 0.70919], [7.5723, -0.86981], [8.82779, -0.16145], [7.33056, -0.61389], [6.77817, -0.62105], [5.19136, -0.81749], [9.88442, 0.11854], [6.53436, 0.34271], [1.6159, -0.95042], [6.11039, -0.68089], [2.78952, -0.53847], [6.40963, 0.62786], [5.64373, 0.63617], [7.72583, 0.8071], [7.90369, -0.82524], [6.24101, 0.55234], [3.91617, -0.366], [9.08316, 0.20432], [5.71643, 0.138], [0.66876, 0.99622], [5.79957, -0.60875], [9.97662, 0.85729], [1.56745, -0.78355], [9.92458, 0.69576], [9.84829, 0.60556], [6.64813, 0.29854], [9.99132, -0.98942], [1.86997, -0.19013], [7.22451, -0.36274], [5.97558, 0.67201], [5.01556, 0.85506], [7.76634, -0.35718], [8.3994, 0.81415], [8.40404, 0.10865], [8.46555, -0.98049], [3.80856, 0.44479], [3.99113, -0.27559], [0.81745, 0.9819], [2.44045, 0.99491], [4.82842, -0.15043], [1.65833, 0.35383], [0.95977, 0.94845], [3.19593, -0.54362], [6.78894, -0.80639], [7.65682, -0.70308], [1.96243, -0.0987], [8.30733, 0.47788], [9.13605, -0.69659], [0.03834, 0.98143], [4.78917, 0.19824], [1.77566, -0.29851], [2.28734, 0.31357], [1.23211, -0.7701], [4.38704, 0.07534], [0.95359, -0.77386], [6.80821, 0.44726], [0.29511, 0.93114], [7.85132, -0.43356], [7.38771, 0.70554], [0.32209, 0.11266], [8.82096, -0.36342], [3.97792, 0.51528], [4.52343, 0.59078], [4.3477, 0.98981], [5.08501, -0.3938], [1.549, -0.33219], [1.94126, 0.2592], [9.79649, -0.68867], [1.29989, -0.99856], [2.1248, 0.19611], [0.17755, -0.42095], [6.19071, 0.32741], [0.59213, -0.53632], [6.38917, 0.75157], [7.07441, -0.75322], [8.24439, -0.42499], [7.61032, -0.12725], [9.44926, -0.722], [7.34584, 0.05461], [4.12453, 0.61446], [1.14628, -0.65993], [6.97393, 0.34013], [6.44926, -0.75313], [7.05935, -0.61552], [6.37308, 0.2828], [2.41448, 0.1769], [6.42822, 0.40506], [1.5332, 0.29967], [4.51049, -0.44318], [9.1008, -0.12775], [5.27423, 0.37561], [0.4757, -0.94026], [9.73609, 0.89928], [4.71028, -0.01887], [3.37534, -0.76705], [3.30068, -0.99205], [9.23915, -0.0514], [6.61621, -0.83937], [0.33323, 0.3858], [3.22633, -0.65512], [6.35082, -0.99403], [6.26086, 0.79969], [2.79312, -0.97044], [4.46552, 0.30909], [2.93964, -0.97321], [6.54585, 0.93482], [4.09987, 0.29523], [3.65824, 0.73404], [2.41262, -0.32109], [9.4706, -0.2008], [1.51244, -0.4569], [5.89405, 0.95761], [6.07558, 0.5552], [7.60107, 0.86745], [4.25665, 0.02249], [3.07627, 0.99751], [6.64516, 0.79107], [8.97732, 0.56914], [2.49598, -0.89241], [7.2786, 0.56667], [9.65909, -0.10074], [3.93147, 0.93743], [1.78505, 0.81096], [6.98248, -0.47817], [9.65668, 0.2368], [7.36848, -0.74506], [2.91336, 0.77552], [5.0727, -0.89907], [8.49628, -0.83207], [7.10955, 0.21278], [4.73913, -0.60108], [4.11708, 0.4986], [5.80937, -0.76033], [5.70809, -0.96445], [0.02858, -0.74893], [7.71211, -0.18973], [3.54964, -0.08323], [2.82844, 0.68723], [8.65761, -0.9779], [1.26272, 0.39026], [8.83703, 0.24834], [2.79951, 0.48716], [0.57689, 0.62469], [3.50405, 0.39587], [7.21978, 0.04318], [6.94472, -0.65762], [4.51853, -0.16162], [6.62158, -0.5635], [5.1979, -0.47145], [6.95807, 0.91438], [7.07842, 0.40279], [9.08231, -0.97118], [9.71158, -0.23458], [8.54233, 0.99198], [1.81434, 0.17948], [5.87096, -0.07838], [1.01265, -0.48773], [2.94566, -0.73092], [2.62351, -0.68558], [8.93628, -0.58477], [5.44415, -0.86108], [5.76215, 0.61015], [9.09312, 0.68029], [3.54682, -0.89644], [6.899, 0.57216], [1.93348, -0.30618], [1.0621, -0.28371], [1.26133, -0.03023], [1.02027, -0.12628], [8.77723, 0.99187], [6.00631, -0.00845], [5.97079, 0.85649], [5.61091, -0.3471], [4.00044, 0.09668], [3.37417, -0.3658], [4.03425, 0.98756], [0.79868, -0.45221], [2.30693, -0.78744], [1.94058, 0.02177], [4.89453, -0.86995], [2.03725, -0.73872], [2.40424, -0.99527], [5.39983, 0.71242], [8.07388, -0.00398], [0.00298, 0.14878], [2.24988, -0.54599], [2.57902, 0.58427], [6.85485, 0.14355], [1.59945, 0.11541], [7.10914, -0.99906], [3.10896, 0.3596], [6.79722, 0.78536], [6.0554, -0.24299], [7.11854, -0.05413], [7.71227, 0.24589], [7.57515, 0.64777], [4.92534, -0.2112], [0.93783, 0.21446], [6.46545, -0.63672], [2.238, 0.01001], [4.93916, 0.05023], [6.44478, -0.15289], [3.85445, -0.68707], [1.81623, 0.56085], [9.53239, 0.12749], [6.60417, -0.97212], [1.9107, -0.54569], [9.93686, 0.52224], [4.58996, 0.46717], [2.34129, -0.62854], [3.52478, -0.28979], [6.18968, -0.8362], [5.60227, -0.04774], [1.28599, -0.19153], [9.64794, -0.99229], [4.61531, 0.06607], [0.69701, -0.80579], [5.59513, 0.50326], [0.64798, -0.26835], [0.24303, 0.45776], [3.65881, 0.96425], [9.34492, 0.94312], [0.45428, 0.20635], [8.75747, 0.55498], [4.41992, -0.98714], [9.8665, -0.98619], [5.7089, -0.68756], [0.6961, 0.26373], [5.74002, 0.35425], [9.00054, -0.19627], [9.82762, -0.00367], [4.97902, -0.59844], [3.12921, -0.2952], [9.24089, 0.75016], [2.35211, 0.67803], [5.14231, 0.37028], [8.68919, 0.41634], [4.38057, -0.83517], [4.1, -0.99937], [7.52094, -0.72582], [8.09444, -0.97551], [9.64606, 0.10557], [8.0561, 0.71995], [4.94874, 0.27725], [9.33379, 0.6261], [9.47221, -0.07738], [7.96551, -0.72842], [4.62018, -0.23196], [6.8783, -0.1178], [3.2995, -0.0593], [9.74217, 0.6487], [5.02352, 0.1445], [1.32728, -0.69089], [7.81306, 0.03728], [9.35839, -0.16778], [0.50693, -0.81289], [3.23487, 0.19336], [1.66274, -0.27855], [7.5192, 0.98382], [8.88437, 0.63897], [9.14965, -0.86428], [8.62792, -0.73368], [5.71431, 0.85319], [0.87636, -0.65671], [0.46514, -0.5335], [4.64679, -0.35216], [5.14103, -0.99528], [7.9767, 0.38343], [3.00614, 0.52259], [0.59554, 0.10568], [8.1432, -0.16615], [5.24704, -0.69967], [2.68582, 0.80085], [9.51463, -0.58373], [2.60164, -0.09958], [8.28988, 0.73761], [7.57089, 0.13442], [0.83943, 0.10659], [8.52868, 0.72072], [6.3077, 0.387], [1.45121, 0.97841], [1.05943, -0.99647], [4.60187, -0.81234], [7.13529, 0.68336], [0.13543, 0.25886], [6.69341, -0.74255], [8.34097, -0.0821], [1.87468, -0.98474], [9.70797, -0.6004], [7.33175, -0.99608], [0.00576, 0.53766], [4.68122, 0.78157], [5.842, 0.69748]];

	for(var i=0; i<particlesPosition.length; i++) {
		particles[i] = tubeO.circle(2*Math.sqrt(densite)).fill('black').maskWith(tubeMask);

		particles[i].randomY =  particlesPosition[i][1];

		particles[i].animate(duree, '-',-particlesPosition[i][0]*duree/10).during(function(t, morph, eased){
			var point = path1.pointAt(getX(t))
			this.attr({ cx: point.x, cy: this.randomY*point.y+350 })
		}).loop(true)
		/*particles[i].animate(duree, '-',particles[i].randomX*duree).during(function(pos, morph, eased){
			var p1 = new SVG.Point(path1.pointAt(eased * length)).transform(matrix);
			var p2 = new SVG.Point(path2.pointAt(eased * length)).transform(matrix);
			this.attr({ cx: p1.x, cy: this.randomY*p1.y+(1-this.randomY)*p2.y })
		}).loop(true)*/
	}



	//Dessine le tube pour l'écoulement
/*	var tube = draw.group();

	var glassTube = draw.gradient('linear', function(stop) {
	  stop.at({ offset: 0, color: '#9cf', opacity: 0.9 })
		stop.at({ offset: 0.1, color: '#9cf', opacity: 0.9 })
		stop.at({ offset: 0.1, color: '#9cf', opacity: 0.65 })
		stop.at({ offset: 0.5, color: '#fff', opacity: 0.65 })
		stop.at({ offset: 0.9, color: '#9cf', opacity: 0.65 })
		stop.at({ offset: 0.9, color: '#9cf', opacity: 0.9 })
		stop.at({ offset: 1, color: '#9cf', opacity: 0.9 })

	})

	var gaz = tube.rect(700,70).fill('white').move(50,30);
	tube.rect(700,70).fill(glassTube.from(0, 0).to(0, 1)).move(50,30);
	tube.path('M 150 100 v 80 a 100 100 0 0 0 200 0 v -80 h -30 v 80 a 70 70 0 0 1 -140 0 v -80 z').fill('#9cf');
	tube.rect(70,30).fill(darkCopper).move(550,100);
	tube.threads({width:40, length:30, threads:4, outward:true}).move(570,95).rotate(270);
	tube.rect(40,20).fill('url(#vPipe)').move(565,130);
	tube.circle(150).move(510,150).fill('#def').stroke({ width: 8, color: '#345' });
	//var aiguille = tube.path()

	var gaz2 = tube.rect(700,70).fill('white').move(50,363);
	tube.rect(700,70).fill(glassTube.from(0, 0).to(0, 1)).move(50,363);
	tube.path('M 150 433 v 80 a 100 100 0 0 0 200 0 v -80 h -30 v 80 a 70 70 0 0 1 -140 0 v -80 z').fill('#9cf');

*/

	//Redessine l'image en tenant compte des contrôles externes
  redraw();

  function redraw(part) {
		//Récupère les valeurs de l'utilisateur
		diameter = parseFloat(document.getElementById("ouvertureDiameter").value);
		dP = parseFloat(document.getElementById("deltaPression").value);
		radius = 2*Math.sqrt(parseFloat(document.getElementById("densite").value));

		if(particles[0].radius()!=radius) {
			for(var i=0; i<particles.length; i++) {particles[i].radius(radius);}
		}
		//for(var i=0; i<particles.length; i++) {particles[i].radius(radius);}

		ouvertureRight.plot('M 355 310 v '+(40-diameter/2)+' a '+(diameter/5)+' '+(diameter/2)+' 0 0 1 0 '+(diameter)+' v'+(40-diameter/2)+' a 16 40 0 0 0 0 -80 z');
		ouvertureTop.plot('M 355 310 h-10 v '+(40-diameter/2)+' h10 z');
		ouvertureBottom.plot('M 355 390 h-10 v '+(-40+diameter/2)+' h10 z');
		ouvertureBack.plot('M 345 '+(350-diameter/2)+' a '+(diameter/5)+' '+(diameter/2)+' 0 0 1 0 '+(diameter)+' h10 a '+(diameter/5)+' '+(diameter/2)+' 0 0 0 0 -'+(diameter)+' z');

		path1.plot('M 80 -30 c 120 0 240 0 260 '+(8*(80-diameter)/25)+' s 120 -'+((80-diameter)/10)+' 160 -'+((80-diameter)/5)+' s 90 -'+(3*(80-diameter)/25)+' 120 -'+(3*(80-diameter)/25)+' h 100');
		path2.plot('M 80 380 c 120 0 240 0 260 -'+(8*(80-diameter)/25)+' s 120 '+((80-diameter)/10)+' 160 '+((80-diameter)/5)+' s 90 '+(3*(80-diameter)/25)+' 120 '+(3*(80-diameter)/25));

		quoteLine1.plot(70,305, 70, 350-diameter/2);
		quoteLine2.plot(70,395, 70, 350+diameter/2);

  }

</script>
