<div id="imageContainer" class="aspectRation2-1"><div id="resistanceEcoulement"></div></div>

<div class="controls">
	<div class="details open">
		<h2 class="detailsAlwaysVisible" onclick="redraw('intro');">Introduction</h2>
		<p class="detailsToHide">Dans un tube, le débit doit nécessairement être le même en tout point&nbsp;: c'est une conséquence de la loi de la conservation de la matière. Puisque le débit ($Q$) peut être donné par: $$Q=A\cdot v$$ où $A$ est l'aire de la section du tube et $v$ la vitesse du fluide (liquide ou gaz).</p>
		<p class="detailsToHide">Si une partie du tube a une plus petite aire, cela aura pour effet d'augmenter la vitesse du fluide dans cette partie.</p>
		<p class="detailsToHide">Pour respecter le principe de conservation de l'énergie, une augmentation de la vitesse s'accompagnera d'une diminution de la pression dans cette partie du tube tel que montré par le manomètre à eau.</p>
		<label for="relativeDiameter">Diamètre de la partie centrale du tube&nbsp;:&nbsp;<input type="range" id="relativeDiameter" name="relativeDiameter" value="0.75" max="1.5" min="0.4" step="0.01" oninput="redraw()" onchange="redraw()" style="width: 30%; min-width: 300px;"></label>

	</div>



</div>

<script src='utils/includes/vector.js?v=<?php echo mt_rand(); ?>'></script>
<script>
  //Création de l'élément svg (l'image).
  var draw = SVG('resistanceEcoulement').viewbox({ x: 50, y: 25, width: 750, height: 375 });

	//Définition des paramètres par défaut du système.
	var relative = 1; //Diamètre relatif de l'ouvertude
	var diameter = 100; //Diamètre du tube

	var glassColor = new SVG.Color('#6699ff');
	var darkGlassColor = new SVG.Color('#4466cc');
	var lightGlassColor = new SVG.Color('#bbddff');
	var waterColor = new SVG.Color('#1133dd');

	/////////////////////////////////////////////////////////////////////
 	// Création des différents éléments de l'image pour l'introduction //
	/////////////////////////////////////////////////////////////////////

	//Dessin des manomètres
	var manometre = draw.path('M 220 150 v 170 a 20 20 0 0 0 20 20 h 70 a 20 20 0 0 0 20 -20 v -170').fill('none').stroke({ width: 20, color: glassColor });
	var water = draw.path('M 220 260 v 60 a 20 20 0 0 0 20 20 h 70 a 20 20 0 0 0 20 -20 v -60').fill('none').stroke({ width: 8, color: waterColor });

	//Dessin du tube
	var tubeTop = draw.path('M 100 90 v 10 h 500 v -10 z').attr({ fill: glassColor});
	var tubeBottom = draw.path('M 100 200 v 10 h 500 v -10 z').attr({ fill: glassColor});
	var tubeEnd = draw.path('M 600 90 v 10 a 20 50 0 0 1 0 100 v 10 a 24 60 0 0 0 0 -120 z').attr({ fill: darkGlassColor});
	var tubeInt = draw.path('M 100 100 a 20 50 0 0 1 0 100 h 500 a 20 50 0 0 0 0 -100 z').attr({ fill: lightGlassColor});

	//Dessin des lignes à l'intérieur du tube
	var tubeLines = draw.group();
	tubeLines.line1 = tubeLines.path('M 250 100 a 20 50 0 0 1 0 100').fill('none').stroke({ width: 1, color: glassColor });
	tubeLines.line2 = tubeLines.path().fill('none').stroke({ width: 1, color: glassColor });
	tubeLines.line3 = tubeLines.path().fill('none').stroke({ width: 1, color: glassColor });
	tubeLines.line4 = tubeLines.path('M 450 100 a 20 50 0 0 1 0 100').fill('none').stroke({ width: 1, color: glassColor });

	//Dessin des lignes et du texte pour la variation de pressionTube
	var pressure = draw.group();
	pressure.line1 = pressure.path().fill('none').stroke({ width: 1, color: 'black', dasharray: '10,12' });
	pressure.line2 = pressure.path().fill('none').stroke({ width: 1, color: 'black', dasharray: '10,12' });
	pressure.quoteline = pressure.path().fill('none').stroke({ width: 1, color: 'black' }).vector({size:1.5,position:'both',style:'curved'});
	pressure.dP = pressure.text("ΔP").font({family: 'Helvetica', size: 24, anchor: 'middle'}).move(430,247);
	pressure.explication1 = pressure.text("Puisque la partie centrale est\nplus étroite, le fluide s'y déplace\nplus rapidement et la pression y\nest plus faible.").font({family: 'Helvetica', size: 18}).move(470,230);
	pressure.explication2 = pressure.text("Puisque la partie centrale est\nplus large, le fluide s'y déplace\nplus lentement et la pression y\nest plus élevée.").font({family: 'Helvetica', size: 18}).move(470,230);



	var path1 = draw.path('M 100 -45 h 500').stroke('none').fill('none');

	var tubeMask = draw.mask().add(draw.path('M 100 100 a 20 50 0 0 1 0 100 v50 h 500 v-50 a 20 50 0 0 0 0 -100 v -50 h -500 z').fill({ color: '#fff' }))

	function getX(t) { //Détermine la position x des particules en fonction du temps.
		//La particule doit aller à la vitesse 1 entre x=0 et 150 et après 350, vitesse 2 entre 200 et 300
		var steps = [140,60,100];
		var v1=700;
		var relative = parseFloat(document.getElementById("relativeDiameter").value);
		var v2 = v1/(relative**2);
		var a = (v2**2-v1**2)/(2*steps[1]);

		var tmax = steps[0]/v1;
		if(t<tmax || relative==1) {return v1*t;} //Si relative==1, les particules vont toujours à la vitesse v1...

		t -= tmax;
		tmax = (-v1 + Math.sqrt(v1**2+2*a*steps[1]))/a;
		if (t < tmax) {return steps[0]+v1*t+0.5*a*t**2;}

		t -= tmax;
		tmax = steps[2]/v2;
		if (t < tmax) {return steps[0]+steps[1]+v2*t;}

		t -= tmax;
		tmax = (v2 - Math.sqrt(v2**2-2*a*steps[1]))/a;
		if (t < tmax) {return steps[0]+steps[1]+steps[2]+v2*t-0.5*a*t**2;}

		t -= tmax;
		return steps[0]+2*steps[1]+steps[2]+v1*t;
	}

	var particles=[], duree = 10000;
	var particlesPosition=[[1.78086, -0.47944], [1.41952, 0.15495], [5.55647, -0.34378], [1.56993, -0.93374], [3.65295, 0.23508], [5.65999, 0.66505], [4.81387, 0.27011], [7.1002, 0.97657], [5.56212, 0.34115], [2.47503, 0.4668], [8.9151, -0.50953], [0.01517, 0.70545], [8.99465, 0.73106], [0.92926, 0.69209], [1.71463, 0.28999], [4.03777, 0.47393], [1.68907, 0.01333], [8.62847, 0.03975], [0.18731, -0.45718], [8.04092, 0.85355], [3.84091, -0.87056], [2.4443, -0.18607], [3.48446, -0.31697], [6.58236, 0.14249], [2.903, 0.04949], [2.1438, 0.48724], [2.07773, -0.54281], [8.2228, -0.96514], [8.45003, -0.70602], [2.69543, -0.58641], [4.48313, -0.61562], [7.07171, 0.63211], [4.55316, -0.94488], [5.35182, 0.58961], [6.54878, -0.86195], [6.51578, 0.90184], [4.46068, -0.21134], [9.71465, -0.31765], [9.94779, -0.6083], [4.98073, -0.59046], [9.45455, -0.97579], [9.79422, 0.76339], [6.03464, -0.86542], [5.00656, -0.09018], [8.45377, 0.87666], [4.91253, -0.92075], [8.01341, 0.16166], [9.25628, 0.93384], [3.54335, -0.63568], [0.84613, -0.13512], [1.60086, 0.63152], [7.11871, -0.48559], [0.37137, 0.33097], [7.2131, 0.3002], [1.29161, -0.15494], [8.63759, 0.49742], [5.98371, 0.94002], [2.28027, 0.79207], [3.98029, 0.75195], [2.94287, 0.49569], [6.14653, -0.11958], [3.17567, -0.49161], [0.51286, 0.88462], [5.96596, 0.47713], [7.68112, -0.04119], [2.75192, -0.99615], [3.97345, -0.56628], [9.03542, 0.21332], [9.13139, -0.90761], [7.82673, -0.57837], [0.96854, 0.41435], [5.18363, 0.92967], [2.01535, -0.93583], [4.60418, 0.79413], [7.58332, 0.87673], [2.7755, 0.72805], [6.91294, 0.07727], [5.38911, 0.05328], [0.72966, -0.41912], [8.82322, -0.85215], [9.9096, 0.12096], [2.00739, 0.18167], [3.24552, -0.05553], [7.81582, 0.49784], [0.67794, -0.91994], [5.84508, -0.65298], [9.52414, 0.41123], [1.29125, 0.98945], [6.6619, -0.34324], [8.74066, 0.97186], [8.97189, -0.15404], [7.48652, 0.37345], [2.84089, -0.25918], [7.63128, -0.91685], [9.34684, 0.06905], [0.46731, -0.18331], [9.84451, -0.98559], [1.15307, -0.73136], [7.53262, -0.32989], [3.74674, 0.96533], [3.29306, 0.46904], [0.1561, 0.97796], [6.30737, -0.34925], [4.43128, 0.08104], [0.96895, -0.94611], [2.03846, -0.25741], [5.37367, -0.7589], [1.5199, -0.60682], [6.46694, 0.54097], [5.78584, 0.11056], [4.30191, 0.77193], [8.19731, -0.08567], [3.59583, 0.73534], [0.16413, -0.00038], [4.20607, -0.82956], [3.28628, -0.98512], [0.56631, 0.0729], [4.10238, -0.02944], [6.75545, 0.55727], [8.34263, 0.52485], [0.0169, 0.28277], [4.96839, 0.49942], [5.15147, -0.36699], [2.31282, -0.9849], [0.03868, -0.82167], [7.01255, -0.85133], [8.11674, -0.39987], [6.2938, -0.96201], [6.80758, 0.87664], [1.11578, -0.45703], [2.40081, -0.69621], [5.09221, 0.19854], [4.19368, -0.36255], [2.99238, -0.76657], [0.39781, -0.74355], [4.43697, 0.40992], [4.7045, -0.33805], [5.64697, 0.98841], [7.16956, -0.06003], [9.50672, -0.58417], [7.31007, -0.79901], [2.60205, 0.04417], [2.53038, 0.95073], [2.00756, 0.84157], [3.32301, 0.93097], [3.90339, -0.24526], [9.97308, -0.21541], [9.85216, 0.48738], [5.84195, -0.21733], [3.08781, 0.25352], [1.36291, 0.47617], [8.50793, -0.27469], [6.48659, -0.12281], [9.36279, -0.30431], [8.37147, 0.21902], [5.68949, -0.96833], [6.72862, -0.63808], [9.51774, 0.69145], [1.12482, 0.18827], [3.07358, 0.81671], [6.0372, -0.44328], [9.23764, 0.40779], [6.1572, 0.67378], [1.62957, 0.97458], [7.9498, -0.93072], [9.16962, -0.62992], [9.58226, 0.97541], [4.8924, 0.87811], [7.88452, -0.23108], [0.61463, 0.55705], [6.27871, 0.3109], [8.56482, -0.98368], [6.26466, -0.66915], [1.57421, -0.24362], [2.23932, 0.02761], [9.96589, 0.98139], [3.59865, -0.03362], [0.89998, 0.97775], [6.93552, -0.20435], [7.52743, -0.62468], [7.39866, 0.66531], [0.26094, -0.99369], [9.58399, -0.06846], [8.16901, -0.68456], [3.56045, -0.95334], [3.35743, 0.19545], [1.20995, 0.70447], [0.88037, -0.65107], [0.33394, 0.62711], [2.74272, 0.30515], [4.71433, -0.063], [3.92843, 0.20375], [3.74947, 0.50539], [7.42218, 0.06864], [1.24054, -0.99974], [0.85197, 0.16242], [1.86268, 0.5275], [5.21571, -0.98815], [8.9111, 0.46309], [2.84939, 0.9985]];
	for(var i=0; i<particlesPosition.length; i++) {
		particles[i] = draw.circle(3).fill('black').maskWith(tubeMask);

		particles[i].randomY = particlesPosition[i][1];

		particles[i].animate(duree, '-',-particlesPosition[i][0]*duree/10).during(function(t, morph, eased){
			var point = path1.pointAt(getX(t))

			this.attr({ cx: point.x, cy: this.randomY*point.y+150 })
		}).loop(true)
	}


	//Redessine l'image en tenant compte des contrôles externes
  redraw();

  function redraw(part) {
		//Récupère les valeurs de l'utilisateur
		diameter =100;
		relative = parseFloat(document.getElementById("relativeDiameter").value);

		var delta = diameter*(1-relative)/2;
		tubeTop.plot('M 100 90 v 10 h 150 l 50 '+delta+' h 100 l 50 '+(-delta)+' h 150 v -10 h -150 l -50 '+delta+' h -100 l -50 '+(-delta)+' h -150').attr({ fill: glassColor});
		tubeBottom.plot('M 100 200 v 10 h 150 l 50 '+(-delta)+' h 100 l 50 '+(delta)+' h 150 v -10 h -150 l -50 '+(-delta)+' h -100 l -50 '+(delta)+' h -150').attr({ fill: glassColor});
		tubeInt.plot('M 100 100 a 20 50 0 0 1 0 100 h 150 l 50 '+(-delta)+' h 100 l 50 '+(delta)+' h 150 a 20 50 0 0 0 0 -100 h -150 l -50 '+delta+' h -100 l -50 '+(-delta)+' h -150').attr({ fill: lightGlassColor});

		if(relative==1) {
			tubeLines.hide();
			pressure.hide();

			path1.plot('M 100 -45 h 550');
		}
		else {
			tubeLines.line2.plot('M 300 '+(100+delta)+' a '+(20*relative)+' '+(50*relative)+' 0 0 1 0 '+(100*relative));
			tubeLines.line3.plot('M 400 '+(100+delta)+' a '+(20*relative)+' '+(50*relative)+' 0 0 1 0 '+(100*relative));
			tubeLines.show();
			pressure.show();

			if(relative>1) {
				pressure.explication1.hide();
				pressure.explication2.show();

				var closePosition = 5*(1-relative);
				path1.plot('M 100 -45 c 140 0, 140 0, 150 '+(closePosition)+' s 30 '+(delta-closePosition)+', 100 '+(delta-closePosition)+' s 90 '+(-delta+2*closePosition)+', 100 '+(-delta+closePosition)+' s 10 '+(-closePosition)+', 200 '+(-closePosition));
			}
			else {
				pressure.explication1.show();
				pressure.explication2.hide();

				var closePosition = 5*(1-relative);
				path1.plot('M 100 -45 c 190 0, 190 '+(delta-2*closePosition)+', 200 '+(delta-closePosition)+' s 90 '+closePosition+', 100 0 s 10 '+(-delta+closePosition)+', 250 '+(-delta+closePosition));
			}
		}

		var pressureDelta = 85*(1-relative)
		water.plot('M 220 '+(260+pressureDelta)+' v '+(60-pressureDelta)+' a 20 20 0 0 0 20 20 h 70 a 20 20 0 0 0 20 -20 v '+(-60-pressureDelta));
		pressure.line1.plot('M 215 '+(260+pressureDelta)+' h 190');
		pressure.line2.plot('M 325 '+(260-pressureDelta)+' h 80');
		pressure.quoteline.plot('M 396.5 '+(260-pressureDelta)+' v '+2*pressureDelta);
  }

</script>
