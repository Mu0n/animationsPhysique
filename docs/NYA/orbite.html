<div class="imageContainer aspectRation2-1"><div id="orbite"></div></div>

<div class="controls">
  <label for="masseCentre">Masse de l'objet central:&nbsp;<input type="range" id="masseCentre" name="masseCentre" value="30" max="40" min="24" step="0.2" oninput="redraw()" onchange="redraw()"></label>
  <button type="button" onclick="redraw()">Click Me!</button>
  <label for="vitesseTangentielle">Vitesse Tangentielle:&nbsp;<input type="checkbox" class="switch" id="vitesseTangentielle" name="vitesseTangentielle"></label><br>
  <label for="trace">Trace d'orbite:&nbsp;<input type="checkbox" class="switch" id="trace" name="trace"></label><br>
  </div>
</div>

<script src='utils/includes/vector.js'></script>
<script>
  //Paramètres fudge-factor pour aider à créer une animation satisfaisante
  var constanteG = 1000;
  var maxTracesOrbite = 4;
  var tracesOrbite = [];
  var delayEnMs = 22;
  var signet = 0;
  
  
  //Paramètres de la masse centrale; positions en coordonnées absolues
  var solX = 500;
  var solY = 250;
  
  //Paramètres du satellite; positions en coordonnées absolues
  var posX = 800;
  var posY = 250;
  var vitesseX = 0.0;  var vitesseY = -9;
  var accX = 0.0;  var accY = 0.0;

  //Tentative de réunion des variables de cinematique du satellite sous le même chapiteau
  var cin = {
    "posX" : 800,
    "posy" : 250,
    "vitesseX" : 0.0,
    "vitesseY" : -9.0,
    "accX" : 0.0,
    "accY" : 0.0
  }
  
  //Création de l'élément svg (l'image).
  var draw = SVG('orbite').viewbox({ x: 0, y: 0, width: 1000, height: 500 });
  
  //Création des différents éléments de l'image
  var masseCentre = draw.circle(1).attr({ cx: solX, cy: solY, fill: '#ffffff' });

  //Création de plusieurs Satellites en avance pour la fonctionalité de trace
  //for(i=0; i < maxTracesOrbite; i++){
  //  var masseSat = draw.circle(15).attr({ cx: posX, cy: posY, fill: '#ffffff' });
  //  tracesOrbite.push(masseSat);
  //}

 var masseSat = draw.circle(15).attr({ cx: cin.posX, cy: cin.posY, fill: '#ffffff' });

	//Redessine l'image en tenant compte des contrôles externes
  var partLeBal = setInterval(redraw,delayEnMs);

    var vitTan = draw.line(posX, posY, 10, 15).stroke({width: 1}).vector({size:4});

  function itereCinematique(cin){


  }

  function redraw() {
  
		//Définit et récupère les valeurs nécessaires à l'image.
    var rC = parseFloat(document.getElementById("masseCentre").value);
	//Ajuste les rayons de la source et de l'objet et la position de l'objet.
    masseCentre.radius(rC);

	var locX = localX(posX);
	var locY = localY(posY);

	var distAuCarre = locX*locX + locY*locY;
	var dist = Math.sqrt(distAuCarre);
	
	var acc = constanteG * rC * 1.0 / distAuCarre;
	
	var accX = -(locX / dist) * acc;
	var accY = -(locY / dist) * acc;
	
	//Algorithme Euler, la vitesse est modifiée avant la position
	vitesseX += accX;
	vitesseY += accY;
	
	locX += vitesseX;
	locY += vitesseY;
	
	//Rafraichit les positions en coordonnées globales et redessine le satellite
	posX = globalX(locX);
	posY = globalY(locY);
	masseSat.cx(posX).cy(posY);
	
	if(document.getElementById('vitesseTangentielle').checked) {
		vitTan.plot(posX, posY, posX + 5*vitesseX, posY - 5*vitesseY);
		vitTan.show();
	} else{
		vitTan.hide();
	}
	
	if(document.getElementById('trace').checked) {
	    var nouveauSat = draw.circle(15).attr({ cx: posX, cy: posY, fill: '#ffffff' });
		if(signet == maxTracesOrbite) {
			tracesOrbite.shift();
			signet--;
			tracesOrbite.length = Math.min(tracesOrbite.length, maxTracesOrbite);
		}
		tracesOrbite.add(nouveauSat);
		signet++;
		
	}
  }
  
  function localX(globalX){
		var retVal = globalX - solX;
		return retVal;
  }
  
  function  localY(globalY){
		var retVal = solY - globalY;
		return retVal;
  }
  
  function globalX(localX){
		var retVal = localX + solX;
		return retVal;
  }
  
  function globalY(localY){
		var retVal = solY - localY;
		return retVal;
  }

</script>
